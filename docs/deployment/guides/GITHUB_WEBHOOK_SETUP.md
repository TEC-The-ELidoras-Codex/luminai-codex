# üîó GitHub Webhook Setup ‚Äî Complete Guide

When your GitHub App needs to **listen for events** (PR opened, issue created, code pushed, etc.), it uses webhooks.

---

## üéØ Quick Answer: Where to Get Webhook & Secret

### Step 1: Go to GitHub App Settings

1. Visit: <https://github.com/settings/apps>
2. Click your app: **tec-resonance-automation** (App ID: 2186310)
3. In the left sidebar, click **"Webhooks"** (near the bottom)

### Step 2: Find Webhook URL & Secret

On the **Webhooks** page, you'll see:

| Field | What It Is | Example |
|---|---|---|
| **Payload URL** | Where GitHub sends webhook events | `https://your-domain.com/webhook/github` or `http://localhost:3000/webhook` |
| **Content type** | Always `application/json` | (already set) |
| **Secret** | Token to verify webhook authenticity | `whsec_...` (auto-generated by GitHub) |
| **SSL verification** | Check certificate validity | Keep enabled in production |

---

## üöÄ Setting Up Webhooks ‚Äî Three Scenarios

### Scenario A: **Local Development** (Webhook on localhost)

**Problem:** GitHub can't reach `http://localhost:3000/webhook` from the internet.

**Solution: Use Ngrok (Tunneling)**

```bash
# Install ngrok
brew install ngrok  # macOS
# OR
choco install ngrok  # Windows
# OR
sudo apt install ngrok  # Linux

# Start ngrok to forward external traffic to localhost:3000
ngrok http 3000
# Output:
#   Forwarding   https://abc123.ngrok.io -> http://localhost:3000

# Copy the HTTPS URL (e.g., https://abc123.ngrok.io)
```

**Then in GitHub App Settings:**

1. Go to Webhooks ‚Üí **Edit**
2. Change **Payload URL** to: `https://abc123.ngrok.io/webhook`
3. Leave **Secret** auto-filled (or generate new if prompted)
4. Click **Update webhook**
5. Copy the secret to your `.env.local`:

```dotenv
GITHUB_APP_WEBHOOK_SECRET=whsec_xxxxxxxxxxxx
```

**Test it:**

```bash
# In another terminal, start your local server
node bootstrap.js

# GitHub will now send events to your local machine via ngrok!
```

---

### Scenario B: **Production Deployment** (Webhook on Live Domain)

**Your Setup:**

- Domain: `luminai-codex.com` (or your actual domain)
- Webhook endpoint: `https://luminai-codex.com/webhook/github`

**Steps:**

1. Go to GitHub App Settings ‚Üí **Webhooks**
2. Click **Edit** (or add new if empty)
3. Set **Payload URL**: `https://luminai-codex.com/webhook/github`
4. Ensure **SSL verification** is enabled (checked)
5. Copy or generate the **Secret**:
   - If empty, GitHub will generate one when you save
   - If already present, use the existing one
6. Click **Update webhook**

**Then add to your `.env` file (on production server):**

```dotenv
GITHUB_APP_WEBHOOK_SECRET=whsec_xxxxxxxxxxxx
GITHUB_APP_WEBHOOK_URL=https://luminai-codex.com/webhook/github
```

**Verify it works:**

```bash
# On your production server, check webhook deliveries
# GitHub App Settings ‚Üí Webhooks ‚Üí Recent Deliveries
# Should show green ‚úì status for events

# Or test manually:
curl -X POST https://your-domain.com/webhook/github \
  -H "Content-Type: application/json" \
  -H "X-GitHub-Hook-ID: 12345" \
  -d '{"action":"opened","pull_request":{"number":1}}'
```

---

### Scenario C: **GitHub Actions** (No Webhook Needed, Just Use `on:` Events)

**Problem:** Webhooks are for **external servers listening for events**. GitHub Actions don't need webhooks‚Äîthey respond natively via workflow triggers.

**Solution: Use workflow triggers instead**

```yaml
# .github/workflows/on-pr.yml
name: On Pull Request
on:
  pull_request:
    types: [opened, synchronize, reopened]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Run tests
        run: npm test
```

**No webhook secret needed here** ‚Äî GitHub Actions handles it automatically.

---

## üìã Complete Webhook Settings Reference

### GitHub App ‚Üí Webhooks ‚Üí Edit

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Webhook settings                                        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                         ‚îÇ
‚îÇ Payload URL *                                           ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ ‚îÇ https://luminai-codex.com/webhook/github            ‚îÇ ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ Content type                                            ‚îÇ
‚îÇ  ‚óã application/json  (SELECTED)                         ‚îÇ
‚îÇ  ‚óã application/x-www-form-urlencoded                    ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ Secret *                                                ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ ‚îÇ whsec_xxxxxxxxxxxx (auto-filled)                     ‚îÇ ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ SSL verification                                        ‚îÇ
‚îÇ ‚òë Verify SSL certificates                              ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ Active                                                  ‚îÇ
‚îÇ ‚òë Deliveries for this webhook will be attempted       ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ Events to trigger on                                    ‚îÇ
‚îÇ ‚óã Just the push event                                  ‚îÇ
‚îÇ ‚óã Send me everything (wildcard event)                  ‚îÇ
‚îÇ ‚óè Let me select individual events: ‚¨áÔ∏è                 ‚îÇ
‚îÇ   ‚òë Pull requests                                      ‚îÇ
‚îÇ   ‚òë Pushes                                             ‚îÇ
‚îÇ   ‚òë Issues                                             ‚îÇ
‚îÇ   ‚òë Issue comments                                     ‚îÇ
‚îÇ   ‚òê ...etc                                             ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ [Update webhook] [Delete]                              ‚îÇ
‚îÇ                                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîê Webhook Security: Verifying the Secret

When GitHub sends a webhook event, it includes a signature header. Your server must **verify** this signature to prove the event came from GitHub (not a hacker).

### Node.js Example (Express)

```javascript
const crypto = require('crypto');
const express = require('express');
const app = express();

app.post('/webhook/github', (req, res) => {
  // Get the signature from the request header
  const signature = req.headers['x-hub-signature-256'];
  const payload = req.rawBody; // Raw unparsed body
  
  // Compute expected signature using your secret
  const secret = process.env.GITHUB_APP_WEBHOOK_SECRET;
  const hash = crypto
    .createHmac('sha256', secret)
    .update(payload)
    .digest('hex');
  const expected = `sha256=${hash}`;
  
  // Compare signatures (timing-safe comparison)
  if (!crypto.timingSafeEqual(Buffer.from(signature), Buffer.from(expected))) {
    return res.status(401).send('Unauthorized');
  }
  
  // Signature valid! Process event
  const body = JSON.parse(payload);
  console.log(`Received event: ${body.action} on ${body.pull_request?.title || body.issue?.title}`);
  
  res.status(200).send('OK');
});
```

---

## üß™ Testing Your Webhook (Before Going Live)

### Method A: GitHub UI "Recent Deliveries"

1. Go to GitHub App Settings ‚Üí **Webhooks**
2. Scroll down to **Recent Deliveries**
3. Click any delivery to see:
   - Request body (what was sent)
   - Response from your server
   - Response headers
   - Timing/latency

### Method B: Manual Test Request

```bash
# Generate test payload
SECRET="whsec_xxxxxxxxxxxx"
PAYLOAD='{"action":"opened","pull_request":{"number":123}}'

# Compute signature
SIGNATURE=$(echo -n "$PAYLOAD" | openssl dgst -sha256 -hmac "$SECRET" -hex | cut -d' ' -f2)

# Send test request
curl -X POST https://your-domain.com/webhook/github \
  -H "Content-Type: application/json" \
  -H "X-Hub-Signature-256: sha256=$SIGNATURE" \
  -d "$PAYLOAD"

# Should return 200 OK
```

### Method C: Webhook.site (Online Testing)

For quick testing without ngrok:

1. Go to <https://webhook.site>
2. Copy the unique URL (e.g., `https://webhook.site/xyz123`)
3. Temporarily set GitHub webhook to that URL
4. Trigger an event (open a PR, push code)
5. See the event appear in webhook.site in real-time

---

## ‚ùì FAQ: Webhooks

**Q: What's the difference between webhook URL and endpoint?**  
A: They're the same thing. **Webhook URL** = the full HTTPS address GitHub sends events to. **Endpoint** = the path on your server (`/webhook/github`).

**Q: Can I use `http://` instead of `https://`?**  
A: Not in production. GitHub only accepts `https://` for security. For local dev, use ngrok (which tunnels via `https://`).

**Q: What if my webhook keeps failing?**  
A: Check GitHub's Recent Deliveries:

1. Is the URL reachable? (Status code 200?)
2. Is the secret correct? (Signature match?)
3. Is your server running? (Check logs)
4. Is SSL certificate valid? (HTTPS only)

**Q: Do I need to commit `GITHUB_APP_WEBHOOK_SECRET` to the repo?**  
A: **NO.** Keep it in `.env.local` (gitignored) or GitHub Secrets for CI/CD. Never commit secrets.

**Q: What events should I subscribe to?**  
A: Depends on your app. Common ones:

- `pull_request` ‚Äî when PR opened/closed/reopened
- `push` ‚Äî when code is pushed
- `issues` ‚Äî when issue created/closed
- `issue_comment` ‚Äî when someone comments
- `workflow_run` ‚Äî when CI/CD finishes

**Q: Can I change the webhook URL later?**  
A: Yes, anytime. GitHub ‚Üí App Settings ‚Üí Webhooks ‚Üí Edit. Change the URL and save.

---

## üìç Your Current Setup

Based on your `.env.local`:

```
GITHUB_APP_ID=2186310
GITHUB_APP_CLIENT_ID=Iv23liuCJbwDvim9WppS
GITHUB_APP_WEBHOOK_SECRET=<generated-webhook-secret>  ‚Üê YOUR WEBHOOK SECRET GOES HERE
GITHUB_APP_INSTALLATION_ID=auto-populated-from-webhook  ‚Üê Filled by first webhook event
```

### What You Need to Do

1. **Go to:** <https://github.com/settings/apps/tec-resonance-automation/webhooks>
2. **Check if webhook is already configured:**
   - If yes, copy the **Secret** ‚Üí add to `.env.local`
   - If no, set **Payload URL** (use ngrok for local dev) and let GitHub generate secret
3. **Copy the secret:**

   ```dotenv
   GITHUB_APP_WEBHOOK_SECRET=whsec_xxxxxxxxxxxx
   ```

4. **For production:** Replace ngrok URL with your real domain
5. **Test:** Trigger an event (push, PR, issue) and watch for it in "Recent Deliveries"

---

## üîó Resources

- [GitHub Webhooks Documentation](https://docs.github.com/en/developers/webhooks-and-events/webhooks/about-webhooks)
- [GitHub App Webhooks](https://docs.github.com/en/apps/creating-github-apps/setting-up-a-github-app/creating-a-webhook-for-your-github-app)
- [Webhook Signature Verification](https://docs.github.com/en/developers/webhooks-and-events/webhooks/securing-your-webhooks)
- [Ngrok Documentation](https://ngrok.com/docs)
- [Webhook.site](https://webhook.site)
